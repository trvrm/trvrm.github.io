<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    
        
        <title>trvrm</title>
        
        <link rel="stylesheet" type="text/css" href="/theme/css/bulma.min.css" />
        <link rel="stylesheet" type="text/css" href="/theme/css/style.css" />
</head>

<body>

    <section class="hero is-primary is-bold">
        <div class="hero-head">
            <div class="container">
                <nav class="nav has-shadow">
                        <div class="nav-left">
                                <a class="nav-item is-tab " href="/category/database.html">Database</a>
                                <a class="nav-item is-tab  active " href="/category/software.html">Software</a>
                                <a class="nav-item is-tab " href="/category/systems.html">Systems</a>
                    
                    </div>              
                </nav>
            </div>
        </div>
        <div class="hero-body">
            <div class="container">
                <div class="columns is-vcentered">
                    <div class="column">
                        <h1 class="title">
                            <a href="/">trvrm  </a>
                        </h1>
                        
<h2>Articles in the Software category</h2>
                    </div>
                </div>
            </div>
        </div>
    </section>  
    



    <section class="section">
        <div class="container">
            <p class="subtitle is-4">
                Fri 13 May 2016
            </p>
            
            <h2 class="title is-2">
                <a href="/new-blog-theme.html" rel="bookmark" title="Permalink to New Blog Theme">
                    New Blog Theme
                </a>
            </h2>

            <div class="content is-medium">
                <p>Yesterday I discovered the <a href="http://bulma.io/">Bulma</a> CSS library.  It seems to be basically 'bootstrap for the flexbox world.'</p>
<p>Given that Bootstrap version 4 has been promising us Flexbox support for nearly a year now, I think Bulma could be my
new best CSS friend.  Of course, I won't be able to use it anywhere where I have to support even reasonably old
browsers, but so far it's been very pleasant to work with.</p>
<p>I also used this opportunity to learn how to <a href="http://docs.getpelican.com/en/3.1.1/themes.html">create themes for Pelican</a>.  I basically took the 'simple' theme from the Pelican distribution and systematically rewrote each template
to use Bulma classes.  Here's an example from the <code>article.html</code> template</p>
<div class="highlight"><pre><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">&quot;section&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;subtitle is-4&quot;</span><span class="nt">&gt;</span>
            <span class="cp">{{</span> <span class="nv">article.locale_date</span> <span class="cp">}}</span>
        <span class="nt">&lt;/p&gt;</span>

        <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">&quot;title is-2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">SITEURL</span> <span class="cp">}}</span><span class="s">/</span><span class="cp">{{</span> <span class="nv">article.url</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">rel=</span><span class="s">&quot;bookmark&quot;</span> <span class="na">title=</span><span class="s">&quot;Permalink to </span><span class="cp">{{</span> <span class="nv">article.title</span><span class="o">|</span><span class="nf">striptags</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                <span class="cp">{{</span> <span class="nv">article.title</span> <span class="cp">}}</span>
            <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/h2&gt;</span>
        ...
</pre></div>

            </div>
        </div>
    </section>
    <section class="section">
        <div class="container">
            <p class="subtitle is-4">
                Fri 26 June 2015
            </p>
            
            <h2 class="title is-2">
                <a href="/pelican-atom-and-markdown.html" rel="bookmark" title="Permalink to Pelican, Atom and Markdown">
                    Pelican, Atom and Markdown
                </a>
            </h2>

            <div class="content is-medium">
                <p>I've been using reStructured text in general to write this blog, but I think I'm
going to be switching to Markdown.  As an experiment, I'm writing this post in Markdown.</p>
<p>I'm also writing it in the <a href="https://atom.io/">Atom text editor</a>, which has really come on a
long way since I last tried it.  Specifically, it includes a Markdown preview function, so
I can see the effects of the markup that I'm writing as I write it.</p>
<p>Mostly, I want a rapid way of creating and publishing code snippets, without the mental
overhead of switching between markup languages. Although reStructured text and markdown
are broadly similar, there are subtle differences between them when it comes to things
like syntax highlighting.  But I've discovered today that if I use the triple-backtick
syntax, I can get the same output from Pelican, Atom, and IPython notebooks.</p>
<p>So</p>
<div class="highlight"><pre>    ```python
    def syntax(highlighting=True):
        return &quot;cool huh?&quot;
    ```
</pre></div>


<p>yields</p>
<div class="highlight"><pre> <span class="k">def</span> <span class="nf">syntax</span><span class="p">(</span><span class="n">highlighting</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
   <span class="k">return</span> <span class="s2">&quot;cool huh?&quot;</span>
</pre></div>


<p>And if I paste that into a markdown cell in an IPython notebook, I get the same effect, as
can be seen <a href="https://github.com/trvrm/notebooks/blob/master/Markdown%20Demo.ipynb">here</a></p>
<p>So this seems to be the general way that the open-source ecosystem is going: Markdown
allows me to use the same syntax for my GitHub documentation, my IPython notebooks, and
my blog posts.  </p>
<p>I do use <strong>Sphinx</strong> in various places for Python code documentation, so that will still
require reStructured text, but elsewhere I think Markdown is the way to go</p>

            </div>
        </div>
    </section>
    <section class="section">
        <div class="container">
            <p class="subtitle is-4">
                Thu 01 January 2015
            </p>
            
            <h2 class="title is-2">
                <a href="/asynchronous-python.html" rel="bookmark" title="Permalink to Asynchronous Python">
                    Asynchronous Python
                </a>
            </h2>

            <div class="content is-medium">
                <p>It's possible to get python to do node-like non-blocking requests, this could
take away one of the key reasons for using node.</p>
<p>The following is a full bottle-based python web application.</p>
<p>A client can sucessfully call /test while another client is waiting for
/slowproxy to return a result from a slow web service.</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">gevent</span> <span class="kn">import</span> <span class="n">monkey</span><span class="p">;</span> <span class="n">monkey</span><span class="o">.</span><span class="n">patch_all</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/sleep/&lt;seconds:int&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;Slept For {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>

<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/test&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
     <span class="k">return</span> <span class="s1">&#39;test&#39;</span>


<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/slowproxy/&lt;seconds:int&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">slowproxy</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">requests</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://s.nooro.com/sleeptest.php?seconds=</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">seconds</span>
    <span class="n">response</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span><span class="n">server</span><span class="o">=</span><span class="s1">&#39;gevent&#39;</span><span class="p">)</span>
</pre></div>
<p>My first attempt used grequests, but apparently that's not even necessary.</p>
<p>I guess that the call to monkey.patch_all() even patches the socket code
that requests uses.  I'm very impressed.</p>


            </div>
        </div>
    </section>
    <section class="section">
        <div class="container">
            <p class="subtitle is-4">
                Thu 01 January 2015
            </p>
            
            <h2 class="title is-2">
                <a href="/coffeescript.html" rel="bookmark" title="Permalink to CoffeeScript">
                    CoffeeScript
                </a>
            </h2>

            <div class="content is-medium">
                <p>Through a bizarre twist of history, the entire client-side web runs on a <a class="reference external" href="http://en.wikipedia.org/wiki/Brendan_Eich#Netscape_and_JavaScript">language</a>
that was thrown together in 10 days.</p>
<p>Despite huge investments in their own proprietary technology by the likes of Sun
Microsystems, Adobe and Microsoft, this weird little spinoff of <strong>self</strong> and <strong>scheme</strong>
is everywhere, while client-side Java, ActiveX and Flash fade into obscurity.</p>
<p>Unsurprisingly for a language developed so quickly, Javascript is pretty ugly.
I'm fond of saying that it's a horrible language, with a really nice language
inside trying to get out.  It gets some things, like scoping rules, very, very
wrong.  But it got other things, like anonymous functions, exactly right, long before
they were adopted in Java, C#, or C++.  Even Python, my favourite language ever,
doesn't get them quite right.</p>
<p>Several people have attempted to build a nicer syntax on top of the javascript
virtual machine.  In fact, the <a class="reference external" href="https://github.com/jashkenas/coffeescript/wiki/List-of-languages-that-compile-to-JS">list</a> of languages that compile to JS is startlingly
big.</p>
<p>For the last couple of years I've been using <a class="reference external" href="http://coffeescript.org/">CoffeeScript</a> as my standard javascript syntax.</p>
<p>From the project page:</p>
<blockquote>
&quot;CoffeeScript is a little language that compiles into JavaScript.
Underneath that awkward Java-esque patina, JavaScript has always
had a gorgeous heart. CoffeeScript is an attempt to expose the
good parts of JavaScript in a simple way.&quot;</blockquote>
<p>and I think it achieves this admirably.  It doesn't solve <em>all</em> of javascript's problems -
you can still get into trouble with the Infamous Loop Problem, but it does make the language
considerably more succinct, mostly by stealing ideas from Python and Haskell.</p>
<div class="section" id="examples">
<h2>Examples</h2>
<p>Function definitions go from</p>
<div class="highlight"><pre><span class="kd">function</span> <span class="nx">d</span><span class="p">(</span><span class="nx">x</span><span class="p">){</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="nx">x</span>
<span class="p">}</span>
</pre></div>
<p>to</p>
<div class="highlight"><pre><span class="nv">d = </span><span class="nf">(x) -&gt;</span> <span class="mi">2</span><span class="o">*</span><span class="nx">x</span>
</pre></div>
<p>This makes for very quick object construction:</p>
<div class="highlight"><pre><span class="nv">math =</span>
    <span class="nv">root: </span>  <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span>
    <span class="nv">square: </span><span class="nx">square</span>
    <span class="nv">cube: </span>  <span class="nf">(x) -&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">square</span> <span class="nx">x</span>
</pre></div>
<p>It also borrows Python's list comprehension syntax:</p>
<div class="highlight"><pre><span class="nx">values</span><span class="o">=</span><span class="p">(</span><span class="nx">option</span><span class="p">.</span><span class="nx">value</span> <span class="k">for</span> <span class="nx">option</span> <span class="k">in</span> <span class="nx">question</span><span class="p">.</span><span class="nx">options</span><span class="p">)</span>
</pre></div>
<p>The near complete absense of curly brackets saves a lot of wasted lines in
my source code, and enables me to see what's going on a lot clearer than in raw
javascript.  On the downside, I do find myself fairly regularly testing out code
snippets in the <a class="reference external" href="http://coffeescript.org/">CoffeeScript</a> online compiler to make sure that I've properly understood
how they will be interpreted.</p>
<p>Because CoffeeScript is a compiled language, to work with it effectively requires
integrating the compiler into your toolchain.  For my larger projects I've hand-written
a tool using Python's <a class="reference external" href="https://pypi.python.org/pypi/watchdog">Watchdog</a> package to monitor my source code directories and
output compiled javascript everytime a file changes.</p>
<p>As a nice little extra, my tool jams in a warning message wrapped in an <code class="code">
alert</code>
 call
if the compliation fails, so if I introduce a syntax error in my coffeescript, as soon
as I refresh the page that is using it I'll be presented with the source of the problem.</p>
</div>


            </div>
        </div>
    </section>
    <section class="section">
        <div class="container">
            <p class="subtitle is-4">
                Thu 01 January 2015
            </p>
            
            <h2 class="title is-2">
                <a href="/ipython-with-python-3.html" rel="bookmark" title="Permalink to IPython with Python 3">
                    IPython with Python 3
                </a>
            </h2>

            <div class="content is-medium">
                <p>This took me longer than I was expecting.</p>
<p>In general when working with IPython I use <code class="code">
pip</code>
 rather than <code class="code">
apt-get</code>
, as
pip tends to have more up-to-date packages.</p>
<p>In the end I found the simplest thing to do was to set up IPython in an isolated
virtualenv environment.  The main trick is to let virtualenv know what version of
Python you want it to use by default.</p>
<div class="highlight"><pre>$ virtualenv --python<span class="o">=</span>python3.4 python_3_demo
$ <span class="nb">cd</span> python_3_demo/
$ <span class="nb">source</span> ./bin/activate
$ pip install ipython
$ ipython
</pre></div>
<div class="highlight"><pre><span class="n">Python</span> <span class="mf">3.4</span><span class="o">.</span><span class="mi">0</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Apr</span> <span class="mi">11</span> <span class="mi">2014</span><span class="p">,</span> <span class="mi">13</span><span class="p">:</span><span class="mo">05</span><span class="p">:</span><span class="mi">11</span><span class="p">)</span>
<span class="o">...</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">sys</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
<span class="mf">3.4</span><span class="o">.</span><span class="mi">0</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Apr</span> <span class="mi">11</span> <span class="mi">2014</span><span class="p">,</span> <span class="mi">13</span><span class="p">:</span><span class="mo">05</span><span class="p">:</span><span class="mi">11</span><span class="p">)</span>
<span class="p">[</span><span class="n">GCC</span> <span class="mf">4.8</span><span class="o">.</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
<p>And voila, I have Python 3 in the best Python interpreter ever built, I'm ready to
start wrapping my head around byte arrays and UTF-8 encodings.</p>


            </div>
        </div>
    </section>
    <section class="section">
        <div class="container">
            <p class="subtitle is-4">
                Thu 01 January 2015
            </p>
            
            <h2 class="title is-2">
                <a href="/more-ractive.html" rel="bookmark" title="Permalink to More Ractive">
                    More Ractive
                </a>
            </h2>

            <div class="content is-medium">
                <p>I've used <a class="reference external" href="http://www.ractivejs.org/">Ractive</a> for several projects recently.
It's been like a breath of fresh air.  I've been writing user interfaces of one
kind or another for more than a decade, and keeping <em>what's displayed to the user</em>
in sync with <em>what's stored in the data structures</em> has often been a source of
frustration.</p>
<p>In the javascript world, I've mostly used <a class="reference external" href="http://backbonejs.org/">backbone</a>  and
<a class="reference external" href="http://jquery.com/">jQuery</a> for creating interactive web pages.  While these
tools are very good at what they do, I still find myself writing a fair amount
of code to update data in the model whenever a user interacts with a control, and
to update the control displays whenever data in the model changes.</p>
<p>Enter <strong>Ractive</strong>.  It's not the only library to handle 2-way data binding - Angular,
Knockout and React all play in this space, but it's my current favourite.</p>
<p>Anyway, here's a little demo....</p>
<p>Given a ractive template like this:</p>
<div class="highlight"><pre><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Type in the boxes below.<span class="err">&lt;</span>\p&gt;
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{var1}}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{var2}}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Current values are var1:<span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>{{var1}}<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span>, var2:<span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>{{var2}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span> <span class="na">on-click</span><span class="o">=</span><span class="s">&quot;changeme&quot;</span><span class="p">&gt;</span>Set var1<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</pre></div>
<p>and javascript like this:</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">ractive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ractive</span><span class="p">({</span>
   <span class="nx">el</span><span class="o">:</span><span class="s2">&quot;#demo&quot;</span><span class="p">,</span>
   <span class="nx">template</span><span class="o">:</span><span class="nx">template</span><span class="p">,</span>
   <span class="nx">data</span><span class="o">:</span><span class="p">{</span><span class="nx">var1</span><span class="o">:</span><span class="s1">&#39;beeblebrox&#39;</span><span class="p">,</span><span class="nx">var2</span><span class="o">:</span><span class="s1">&#39;lintilla&#39;</span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
<p>We get:</p>
<script src='http://cdn.ractivejs.org/latest/ractive.js'></script>

<div id="demo" class="well"></div>
<script type="text/javascript">

     var template='<p>Type in the boxes below.<\p> \
                  <input class="form-control" value="{{var1}}">  \
                  <input class="form-control" value="{{var2}}">  \
                  <p>Current values are var1:<code>{{var1}}</code>, var2:<code>{{var2}}</p>\
                  <br><button class="btn btn-primary" on-click="changeme">Set var1</button>';

     var ractive = new Ractive({
        el:"#demo",
        template:template,
        data:{var1:'beeblebrox',var2:'lintilla'}
     });

     ractive.on('changeme',function(){
        ractive.set('var1','zarniwoop');
     });
</script><p>Neat, huh?  I haven't had to write any code to manually react to keyup, or change events
in the input controls - Ractive simply takes care of the fact that I refer to <code class="code">
var1</code>

in both the output paragraph and the control value, and binds the two elements together,
refreshing them whenever needed.</p>
<p>The code for responding to the button click is simply:</p>
<div class="highlight"><pre><span class="nx">ractive</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;changeme&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">ractive</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;var1&#39;</span><span class="p">,</span><span class="s1">&#39;zarniwoop&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<p>By setting data in the underlying model, the user interface automatically updates,
again without any manual intervention.</p>
<div class="section" id="ui-development-might-be-fun-again">
<h2>UI development might be fun again....</h2>
<p>I have the same feeling on discovering Ractive that I had when I was first shown
jQuery.  All of a sudden, a bunch of boring, fiddly manual tasks are taken care
of in an intuitive way.  And unlike other frameworks, <em>all</em> ractive does is data-binding.
It doesn't try to be a control library, an AJAX toolkit or a Model-View-Controller
framework.  For those who like all-in-one solutions, this will be a weakness, but as
someone who believes in the unix philosophy of building systems from tools that
each do one thing well, I'm very impressed.</p>
</div>


            </div>
        </div>
    </section>
    <section class="section">
        <div class="container">
            <p class="subtitle is-4">
                Thu 01 January 2015
            </p>
            
            <h2 class="title is-2">
                <a href="/pdf-generation-with-pelican.html" rel="bookmark" title="Permalink to PDF Generation With Pelican">
                    PDF Generation With Pelican
                </a>
            </h2>

            <div class="content is-medium">
                <p>The existing documentation is a little unclear on this, because it says
you need to add <code class="code">
PDF_GENERATOR=True</code>
 to your <cite>pelicanconf.py</cite> file.</p>
<p>This advice is out of date: PDF generation has been moved to a plugin.</p>
<p>So you need to first make sure you have <code class="code">
rst2pdf</code>
 installed:</p>
<div class="highlight"><pre>$ sudo apt-get install rst2pdf
</pre></div>
<p>and then add the following to <code class="code">
pelicanconf.py</code>
</p>
<div class="highlight"><pre><span class="n">PLUGIN_PATH</span> <span class="o">=</span> <span class="s1">&#39;../pelican-plugins&#39;</span>  <span class="c1"># or wherever.</span>
<span class="n">PLUGINS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span>
</pre></div>
<p>However, doing this seems to screw up the pygments highlighting on my regular
html output.  This is because deep in the rst2pdf code, in a file called <code class="code">
pygments2style.py</code>
,
all the pygment elements have their CSS classes prepended with <code class="code">
pygment-</code>
.  I haven't
figured out how to generate HTML and PDF nicely at the same time.</p>


            </div>
        </div>
    </section>
    <section class="section">
        <div class="container">
            <p class="subtitle is-4">
                Thu 01 January 2015
            </p>
            
            <h2 class="title is-2">
                <a href="/python-comprehensions.html" rel="bookmark" title="Permalink to Python Comprehensions">
                    Python Comprehensions
                </a>
            </h2>

            <div class="content is-medium">
                <p>Python <strong>list comprehensions</strong> are one of the most powerful and useful
features of the language. However, I've noticed even quite experienced
Python programmers using less powerful idioms when a list comprehension
would be the perfect solution to their problem, and even though I've
been a Python developer for more than a decade, I've recently learned
some very nice aspects of this feature.</p>
<div class="section" id="what-s-a-list-comprehension">
<h2>What's a List Comprehension?</h2>
<p>Python is such a strong language in part because of its willingness to
steal ideas from other languages. Python list comprehensions are an idea
that comes from
<a class="reference external" href="http://www.haskell.org/haskellwiki/List_comprehension">Haskell</a>.
Fundamentally, they are a kind of 'syntactic sugar' for construct lists
from other data sources in a tight, elegant fashion.</p>
<p>One of the things I like most about them is they eliminate the need to
manually create loop structures and extra variables. So consider the
following:</p>
<div class="highlight"><pre><span class="n">squares</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">squares</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
<span class="n">squares</span>
</pre></div>
<pre class="literal-block">
[1, 1, 4, 27, 256, 3125, 46656, 823543, 16777216, 387420489]
</pre>
<p>With List Comprehensions we can eliminate both the <code class="code">
for</code>
 loop and the
calls to <code class="code">
append()</code>
</p>
<div class="highlight"><pre><span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
<pre class="literal-block">
[1, 1, 4, 27, 256, 3125, 46656, 823543, 16777216, 387420489]
</pre>
<p>Comprehensions work with any kind of iterable as an import source:</p>
<div class="highlight"><pre><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span> <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="s2">&quot;hello world&quot;</span><span class="p">]</span>
</pre></div>
<pre class="literal-block">
[104, 101, 108, 108, 111, 32, 119, 111, 114, 108, 100]
</pre>
</div>
<div class="section" id="multiple-generators">
<h2>Multiple generators</h2>
<p>To make things a little more complex, we can specifiy more than one
input data source:</p>
<div class="highlight"><pre><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
</pre></div>
<pre class="literal-block">
[(0, 0), (0, 1), (0, 2), (1, 0), (1, 1), (1, 2)]
</pre>
<p>Instead of just boring numbers, we could use this to construct some
sentences.</p>
<div class="highlight"><pre><span class="p">[(</span><span class="n">number</span><span class="p">,</span> <span class="n">animal</span><span class="p">)</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">animal</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cats&#39;</span><span class="p">,</span><span class="s1">&#39;dogs&#39;</span><span class="p">,</span><span class="s1">&#39;elephants&#39;</span><span class="p">]]</span>
</pre></div>
<pre class="literal-block">
[(0, 'cats'),
 (0, 'dogs'),
 (0, 'elephants'),
 (1, 'cats'),
 (1, 'dogs'),
 (1, 'elephants'),
 (2, 'cats'),
 (2, 'dogs'),
 (2, 'elephants')]
</pre>
<p>Furthermore, we have a lot of control over <em>how</em> we construct the final
output objects - we can put any valid python expression in the
left-hand-side.</p>
<div class="highlight"><pre><span class="p">[</span>
    <span class="s2">&quot;{0} {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">adjective</span><span class="p">,</span><span class="n">animal</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">adjective</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;cute&#39;</span><span class="p">,</span><span class="s1">&#39;hungry&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">animal</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span><span class="s1">&#39;puppy&#39;</span><span class="p">,</span><span class="s1">&#39;hippo&#39;</span><span class="p">]</span>
<span class="p">]</span>
</pre></div>
<pre class="literal-block">
['red cat',
 'red puppy',
 'red hippo',
 'cute cat',
 'cute puppy',
 'cute hippo',
 'hungry cat',
 'hungry puppy',
 'hungry hippo']
</pre>
<p>or even</p>
<div class="highlight"><pre><span class="p">[</span>
    <span class="s2">&quot;There are {0} {1} {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">adjective</span><span class="p">,</span><span class="n">animal</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">adjective</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cute&#39;</span><span class="p">,</span><span class="s1">&#39;hungry&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">animal</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;puppys&#39;</span><span class="p">,</span><span class="s1">&#39;bats&#39;</span><span class="p">]</span>
<span class="p">]</span>
</pre></div>
<pre class="literal-block">
['There are 2 cute puppys',
 'There are 2 cute bats',
 'There are 2 hungry puppys',
 'There are 2 hungry bats',
 'There are 3 cute puppys',
 'There are 3 cute bats',
 'There are 3 hungry puppys',
 'There are 3 hungry bats']
</pre>
</div>
<div class="section" id="dictionary-comprehensions">
<h2>Dictionary Comprehensions</h2>
<p>An equally powerful construct is the <em>dictionary comprehension</em>. Just
like list comprehensions, this enables you to construct python
dictionaries using a very similar syntax.</p>
<div class="highlight"><pre><span class="p">{</span>
    <span class="n">key</span><span class="p">:</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span><span class="s1">&#39;bar&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;this&#39;</span><span class="p">,</span><span class="s1">&#39;that&#39;</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
<pre class="literal-block">
{'foo': 'bar', 'k': 'v', 'this': 'that'}
</pre>
<p>Armed with these tools, we can write very concise code to transform data
from one structure to another. Recently I've found them <em>very</em> helpful
for unpacking nested data structures.</p>
<p>Consider a simple org-structure:</p>
<div class="highlight"><pre><span class="n">departments</span><span class="o">=</span><span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;Manufacturing&#39;</span><span class="p">,</span> <span class="s1">&#39;staff&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Jacob&quot;</span><span class="p">,</span><span class="s2">&quot;Jonah&quot;</span><span class="p">,</span> <span class="s2">&quot;Chloe&quot;</span><span class="p">,</span><span class="s2">&quot;Liam&quot;</span><span class="p">]},</span>
    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;Marketing&#39;</span><span class="p">,</span><span class="s1">&#39;staff&#39;</span><span class="p">:[</span><span class="s2">&quot;Emily&quot;</span><span class="p">,</span><span class="s2">&quot;Shawn&quot;</span><span class="p">,</span><span class="s2">&quot;Alex&quot;</span><span class="p">]},</span>
    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;HR&#39;</span><span class="p">,</span><span class="s1">&#39;staff&#39;</span><span class="p">:[</span><span class="s2">&quot;David&quot;</span><span class="p">,</span><span class="s2">&quot;Jessica&quot;</span><span class="p">]},</span>
    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;Accounts&#39;</span><span class="p">,</span><span class="s1">&#39;staff&#39;</span><span class="p">:[</span><span class="s2">&quot;Nicole&quot;</span><span class="p">]}</span>
<span class="p">]</span>
</pre></div>
<p>Now let's extract some data from it.</p>
<div class="highlight"><pre><span class="c1">#Department names</span>
<span class="p">[</span><span class="n">department</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">department</span> <span class="ow">in</span> <span class="n">departments</span><span class="p">]</span>
</pre></div>
<pre class="literal-block">
['Manufacturing', 'Marketing', 'HR', 'Accounts']
</pre>
<div class="highlight"><pre><span class="c1">#Staff count</span>
<span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">department</span><span class="p">[</span><span class="s1">&#39;staff&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">department</span> <span class="ow">in</span> <span class="n">departments</span><span class="p">])</span>
</pre></div>
<pre class="literal-block">
10
</pre>
<div class="highlight"><pre><span class="c1">#All staff names</span>
<span class="p">[</span>
    <span class="n">name</span>
    <span class="k">for</span> <span class="n">department</span> <span class="ow">in</span> <span class="n">departments</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">department</span><span class="p">[</span><span class="s1">&#39;staff&#39;</span><span class="p">]</span>
<span class="p">]</span>
</pre></div>
<pre class="literal-block">
['Jacob',
 'Jonah',
 'Chloe',
 'Liam',
 'Emily',
 'Shawn',
 'Alex',
 'David',
 'Jessica',
 'Nicole']
</pre>
<p>Note how in the last example the <em>second</em> data-generating clause,
<code class="code">
department['staff']</code>
, used a reference from the <em>first</em> one.</p>
<p>We can take this even further. Let's make our org-chart a little more
complicated...</p>
<div class="highlight"><pre><span class="n">departments</span><span class="o">=</span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;Manufacturing&#39;</span><span class="p">,</span>
        <span class="s1">&#39;staff&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s2">&quot;Jacob&quot;</span><span class="p">,</span><span class="s1">&#39;salary&#39;</span><span class="p">:</span><span class="mi">50000</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s2">&quot;Chloe&quot;</span><span class="p">,</span><span class="s1">&#39;salary&#39;</span><span class="p">:</span><span class="mi">60000</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s2">&quot;Liam&quot;</span><span class="p">,</span><span class="s1">&#39;salary&#39;</span><span class="p">:</span><span class="mi">70000</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s2">&quot;Jonah&quot;</span><span class="p">,</span><span class="s1">&#39;salary&#39;</span><span class="p">:</span><span class="mi">55000</span><span class="p">},</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;Marketing&#39;</span><span class="p">,</span>
        <span class="s1">&#39;staff&#39;</span><span class="p">:[</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s2">&quot;Emily&quot;</span><span class="p">,</span><span class="s1">&#39;salary&#39;</span><span class="p">:</span><span class="mi">50000</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s2">&quot;Shawn&quot;</span><span class="p">,</span><span class="s1">&#39;salary&#39;</span><span class="p">:</span><span class="mi">45000</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s2">&quot;Alex&quot;</span><span class="p">,</span><span class="s1">&#39;salary&#39;</span><span class="p">:</span><span class="mi">40000</span><span class="p">},</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;HR&#39;</span><span class="p">,</span>
        <span class="s1">&#39;staff&#39;</span><span class="p">:[</span>

            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s2">&quot;David&quot;</span><span class="p">,</span><span class="s1">&#39;salary&#39;</span><span class="p">:</span><span class="mi">50000</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s2">&quot;Jessica&quot;</span><span class="p">,</span><span class="s1">&#39;salary&#39;</span><span class="p">:</span><span class="mi">60000</span><span class="p">},</span>
       <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;Accounts&#39;</span><span class="p">,</span>
        <span class="s1">&#39;staff&#39;</span><span class="p">:[</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s2">&quot;Nicole&quot;</span><span class="p">,</span><span class="s1">&#39;salary&#39;</span><span class="p">:</span><span class="mi">40000</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
<p>Calculate the total salary:</p>
<div class="highlight"><pre><span class="nb">sum</span><span class="p">(</span>
    <span class="n">person</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">department</span> <span class="ow">in</span> <span class="n">departments</span>
    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">department</span><span class="p">[</span><span class="s1">&#39;staff&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
<pre class="literal-block">
520000
</pre>
<p>Now let's calculate the wages bill by department, and put the results in
a dictionary</p>
<div class="highlight"><pre><span class="p">{</span>
    <span class="n">department</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">person</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">department</span><span class="p">[</span><span class="s1">&#39;staff&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">department</span> <span class="ow">in</span> <span class="n">departments</span>
<span class="p">}</span>
</pre></div>
<pre class="literal-block">
{'Accounts': 40000, 'HR': 110000, 'Manufacturing': 235000, 'Marketing': 135000}
</pre>
<div class="section" id="conclusion">
<h3>Conclusion</h3>
<p>I've been finding this type of approach <em>very</em> helpful when working with
document-oriented data stores. We store a lot of data in JSON documents,
either on the file system or in Postgresql. For that data to be useful,
we have to be able to quickly mine, explore, select and transform it.
Tools like <a class="reference external" href="http://jsonselect.org/#overview">JSONSelect</a> do exist,
but JSONSelect is only available in Javascript, and doesn't allow you to
do the kind of rich expression-based transforms as you roll up the data
that Python does.</p>
<p>I also find that it avoids many common programming pitfalls:
mis-assigned variables, off-by-one errors and so on. You'll note that in
all the examples above I <em>never</em> need to create a temporary variable or
explicitly construct a <code class="code">
for</code>
-loop.</p>
</div>
</div>


            </div>
        </div>
    </section>

   


<section class="section">
    <div class="container">
        
        <nav class="pagination">
            
            <ul>
                    <li class="is-active">
                        <a href="/category/software.html">1</a>
                    </li>
                    <li class="">
                        <a href="/category/software2.html">2</a>
                    </li>
            </ul>
            
            
                <a href="/category/software2.html">Next</a>
        </nav>
    
    </div>

</section>


    <footer class="footer">
        <div class="container">
            <div class="content has-text-centered">
                <p>
                    Powered by <a href="http://getpelican.com/">Pelican</a>, <a href="http://python.org">Python</a>, 
                    and <a href="http://bulma.io/">Bulma</a>
                </p>
            </div>
        </div>
    </footer>
</body>
</html>